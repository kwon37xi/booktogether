<?xml version="1.0" encoding="utf-8"?>

<sqls name="bookGrade">
  
     <sql name="INSERT_BOOKGRADE_SQL">
        <description>책 별점 주기</description>
        <query>
            <![CDATA[
             INSERT INTO BOOKGRADE(book_idNum, user_idNum, grade)  
             VALUES (?, ?, ?)
            ]]>
        </query>
     </sql>
    
     <sql name="MODIFY_BOOKGRADE_SQL">
        <description>책 별점 수정하기</description>
        <query>
            <![CDATA[
             UPDATE BOOKGRADE 
             	SET grade=?
              WHERE idNum=?
            ]]>
        </query>
     </sql>
     
     <sql name="DELETE_BOOKGRADE_SQL">
        <description>책 별점 삭제</description>
        <query>
            <![CDATA[
             DELETE FROM BOOKGRADE 
             WHERE idNum=? 
               AND book_idNum=? 
               AND user_idNum=? 
            ]]>
        </query>
     </sql>
    
     <sql name="LIST_BOOKGRADE_SQL">
        <description>책 별점 목록</description>
        <query>
            <![CDATA[
             SELECT U.idNum as uidNum
             	    ,U.user_id as user_id 
             	    ,U.nickname as user_nickname
             	    ,BG.grade as grade
             	    ,BG.idNum as idNum 
             	    ,BG.book_idNum as bidNum 
             FROM USER U, BOOKGRADE BG  
             WHERE BG.book_idNum = ? 
               AND BG.user_idNum = U.idNum 
               AND U.isdelete=0
             ORDER BY BG.idNum DESC   
             LIMIT ?,? 
            ]]>
        </query>
     </sql>
    
     <sql name="LIST_MYBOOKGRADE_SQL">
        <description>내가 매긴 책 별점 목록</description>
        <query>
            <![CDATA[
             SELECT BG.grade as grade
             	    ,BG.idNum as idNum
             	    ,BG.book_idNum as bidNum 
             	    ,BG.book_idNum as bidNum
             	    ,B.name as bname  
             FROM USER U, BOOKGRADE BG, BOOK B  
             WHERE BG.user_idNum = ?   
               AND BG.user_idNum = U.idNum
               AND BG.book_idNum = B.idNum  
               AND U.isdelete = 0
             ORDER BY BG.idNum DESC  
             LIMIT ?,? 
            ]]>
        </query>
    </sql>
    
     <sql name="GET_DBCOUNT_BOOKGRADE_SQL">
        <description>책 별점 목록</description>
        <query>
            <![CDATA[
             SELECT COUNT(BG.idNum) 
             FROM USER U, BOOKGRADE BG  
             WHERE BG.book_idNum = ? 
               AND BG.user_idNum = U.idNum 
               AND U.isdelete=0 
            ]]>
        </query>
     </sql>
    
     <sql name="GET_DBCOUNT_MYBOOKGRADE_SQL">
        <description>내가 매긴 책 별점 목록 갯수</description>
        <query>
            <![CDATA[
             SELECT COUNT(BG.idNum) 
             FROM USER U, BOOKGRADE BG  
             WHERE BG.user_idNum = ?   
               AND BG.user_idNum = U.idNum 
               AND U.isdelete = 0 
            ]]>
        </query>
    </sql>
    
     <sql name="EXIST_MYBOOKGRADE_SQL">
        <description>내가 매긴 책 별점이 있는지 체크</description>
        <query>
            <![CDATA[
             SELECT count(BG.idNum) as count
             FROM BOOKGRADE BG, USER U 
             WHERE BG.book_idNum = ? 
               AND BG.user_idNum = ? 
               AND BG.user_idNum = U.idNum 
               AND U.isdelete = 0  
            ]]>
        </query>
    </sql>
</sqls>