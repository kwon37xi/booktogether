<?xml version="1.0" encoding="utf-8"?>

<sqls name="bookMark">
  
     <sql name="INSERT_BOOKMARK_SQL">
        <description>인용구 넣기</description>
        <query>
            <![CDATA[
             INSERT INTO BOOKMARK(user_idNum
             					  , book_idNum
             					  , vibe_num
             					  , page
             					  , input_date
             					  , content)  
             VALUES (?, ?, ?, ?, now(), ?)
            ]]>
        </query>
     </sql>
     
     
     <sql name="INSERT_VIBE_SQL">
        <description>공감 등록</description>
        <query>
            <![CDATA[
             INSERT INTO VIBE(user_idNum, bookmark_idNum)  
             VALUES (?, ?)
            ]]>
        </query>
     </sql>
    
     <sql name="MODIFY_BOOKMARK_SQL">
        <description>인용구 수정하기</description>
        <query>
            <![CDATA[
             UPDATE BOOKMARK 
             	SET page=?
             	    ,input_date=now()
             	    ,content=?
              WHERE idNum=?
                AND user_idNum = ? 
                AND book_idNum = ?
            ]]>
        </query>
     </sql>
     
     <sql name="MODIFY_VIBE_BOOKMARK_SQL">
        <description>공감 올리기</description>
        <query>
            <![CDATA[
             UPDATE BOOKMARK 
             	SET vibe_num=vibe_num+1
              WHERE idNum = ? 
                AND book_idNum = ?
            ]]>
        </query>
     </sql>
     
     <sql name="DELETE_BOOKMARK_SQL">
        <description>인용구 삭제</description>
        <query>
            <![CDATA[
             DELETE FROM BOOKMARK 
             WHERE idNum = ? 
               AND book_idNum = ? 
               AND user_idNum = ? 
            ]]>
        </query>
     </sql>
    
    
     <sql name="LIST_BOOKMARK_SQL">
        <description>인용구 목록(책조회시)</description>
        <query>
            <![CDATA[
             SELECT BM.idNum as idNum
                    ,BM.user_idNum as uidNum
                    ,BM.book_idNum as bidNum
                    ,BM.page as page
                    ,BM.input_date as input_date
                    ,BM.content as content 
                    ,BM.vibe_num as vibe_num
                    ,U.user_id as user_id 
                    ,U.name as user_name 
                    ,U.nickname as user_nickname 
               FROM BOOKMARK BM, USER U 
              WHERE BM.user_idNum = U.idNum 
                AND BM.book_idNum = ? 
                AND U.isdelete = 0 
              LIMIT ?,? 
            ]]>
        </query>
     </sql>
     
     
     <sql name="GET_DBCOUNT_BOOKMARK_SQL">
        <description>인용구 목록 갯수(책조회시)</description>
        <query>
            <![CDATA[
             SELECT COUNT(BM.idNum)  
               FROM BOOKMARK BM, USER U 
              WHERE BM.user_idNum = U.idNum 
                AND BM.book_idNum = ? 
                AND U.isdelete = 0 
            ]]>
        </query>
     </sql>
    
    
     <sql name="LIST_MYBOOKMARK_SQL">
        <description>내가 작성한 인용구 목록</description>
        <query>
            <![CDATA[
             SELECT BM.idNum as idNum
                    ,BM.user_idNum as uidNum
                    ,BM.book_idNum as bidNum
                    ,BM.page as page
                    ,BM.input_date as input_date
                    ,BM.content as content 
                    ,BM.vibe_num as vibe_num
               FROM BOOKMARK BM, USER U   
              WHERE BM.user_idNum = ?
              	AND BM.book_idNum = ?
                AND BM.user_idNum = U.idNum   
                AND U.isdelete = 0 
            ]]>
        </query>
     </sql>
     
     
    
     <sql name="EXIST_MYVIBE_SQL">
        <description>내가 매긴 공감이 있는지 체크</description>
        <query>
            <![CDATA[
             SELECT count(*) 
             FROM VIBE 
             WHERE bookmark_idNum = ? 
               AND user_idNum = ? 
            ]]>
        </query>
     </sql>
</sqls>