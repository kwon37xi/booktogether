<?xml version="1.0" encoding="utf-8"?>

<sqls name="library">

	<sql name="GET_LIBRARY_SQL">
		<description>서재 정보 가지고 오기</description>
		<query>
            <![CDATA[
             SELECT L.idNUm as idNum
                    ,L.notice as notice
                    ,L.isOpen as isOpen
                    ,U.idNum as uidNum
                    ,U.name as uname
                    ,U.nickname as unickname
                    ,U.user_id as uid
                    ,UAI.thumnail as thumnail
               FROM LIBRARY L, USER U, USERADDINFO UAI 
              WHERE L.user_idNum = U.idNum 
              	AND U.user_id = ? 
                AND U.isdelete = 0 
                AND U.idNum = UAI.user_idNum 
            ]]>
		</query>
	</sql>
	
	
	<sql name="GET_LIBRARY_IDNUM_SQL">
		<description>서재 정보 가지고 오기</description>
		<query>
            <![CDATA[
             SELECT L.idNUm as idNum
                    ,L.notice as notice
                    ,L.isOpen as isOpen
                    ,U.idNum as uidNum
                    ,U.name as uname
                    ,U.nickname as unickname
                    ,U.user_id as uid
                    ,UAI.thumnail as thumnail
               FROM LIBRARY L, USER U, USERADDINFO UAI 
              WHERE L.user_idNum = U.idNum 
              	AND L.idNum = ? 
                AND U.isdelete = 0 
                AND U.idNum = UAI.user_idNum 
            ]]>
		</query>
	</sql>


	<sql name="MODIFY_LIBRARY_SQL">
		<description>내서재 정보 수정하기</description>
		<query>
            <![CDATA[
             UPDATE LIBRARY 
                SET notice = ?
                    ,isOpen = ? 
              WHERE user_IdNum=? 
                AND idNum = ?  
            ]]>
		</query>
	</sql>


	<sql name="INSERT_LIBRARY_SQL">
		<description>내서재 정보 등록</description>
		<query>
            <![CDATA[
             INSERT INTO LIBRARY(user_idNum, notice, isOpen)  
             VALUES (?, ?, ?) 
            ]]>
		</query>
	</sql>


	<sql name="INSERT_LIBRARYBOOK_SQL">
		<description>서재에 책 등록</description>
		<query>
            <![CDATA[
             INSERT INTO LIBRARYBOOK(book_idNum
             						 , library_idNum
             						 , read_Date
             						 , state
             						 , ispossess)   
             VALUES (?, ?, ?, ?, ?) 
            ]]>
		</query>
	</sql>


	<sql name="LIST_LIBRARYBOOK_SQL">
		<description>서재에 책 목록</description>
		<query>
            <![CDATA[
             SELECT LB.idnum as idNum 
                    ,LB.read_date as read_date 
                    ,LB.state as state 
                    ,LB.ispossess as ispossess 
                    ,LB.book_idNum as bidnum 
                    ,LB.library_idNum as lidnum  
                    ,L.user_idNum as uidNUm 
               FROM LIBRARYBOOK LB, LIBRARY L
              WHERE LB.state = ? 
                AND LB.library_idNum = ? 
                AND LB.library_idNum = L.idNum  
              LIMIT ?, ?
            ]]>
		</query>
	</sql>


	<sql name="GET_DBCOUNT_LIBRARYBOOK_SQL">
		<description>서재에 책 목록 갯수</description>
		<query>
            <![CDATA[
             SELECT COUNT(*) 
               FROM LIBRARYBOOK 
              WHERE state = ?
                AND library_idNum = ?   
            ]]>
		</query>
	</sql>


	<sql name="GET_DUPLICATE_LIBRARYBOOK_SQL">
		<description>서재에 해당책이 있는지 검사</description>
		<query>
            <![CDATA[
             SELECT COUNT(*) as count 
               FROM LIBRARYBOOK 
              WHERE library_IdNum= ? 
                AND book_IdNum = ? 
            ]]>
		</query>
	</sql>


	<sql name="MODIFY_LIBRARYBOOK_SQL">
		<description>서재에 해당책 수정하기</description>
		<query>
            <![CDATA[
             UPDATE LIBRARYBOOK 
                SET state = ? 
                    ,read_date = ?
                    ,ispossess = ?
              WHERE library_idNum = ?
                AND book_idNum = ?
                AND idNum = ? 
            ]]>
		</query>
	</sql>


	<sql name="GET_LIBRARYBOOK_SQL">
		<description>서재에 해당책 조회</description>
		<query>
            <![CDATA[
             SELECT LB.idnum as idNum 
                    ,LB.read_date as read_date 
                    ,LB.state as state 
                    ,LB.ispossess as ispossess 
                    ,LB.book_idNum as bidnum 
                    ,LB.library_idNum as lidnum  
                    ,L.user_idNum as uidNUm 
               FROM LIBRARYBOOK LB, LIBRARY L
              WHERE LB.idNum = ? 
                AND LB.library_idNum = L.idNum  
            ]]>
		</query>
	</sql>
	
	<sql name="GET_B_U_POSSESSBOOK_SQL">
		<description>서재에 해당책 조회(사용자, 책 일련번호)</description>
		<query>
            <![CDATA[
             SELECT idNum as idNum
                    , book_idNum as bidNum
                    , user_idNum as uidNum
                    , purchase_Date as pdate
                    , purchase_Price as price
                    , begin_Read as bread
                    , end_Read as eread
                    , quality as quality
                    , state as state
               FROM POSSESSBOOK 
              WHERE user_idNum = ?
                AND book_idNum = ? 
            ]]>
		</query>
	</sql>


	<sql name="DELETE_LIBRARYBOOK_SQL">
		<description>서재에 해당책 삭제</description>
		<query>
            <![CDATA[
             DELETE FROM LIBRARYBOOK  
              WHERE idNum = ? 
            ]]>
		</query>
	</sql>


	<sql name="INSERT_POSSESSBOOK_SQL">
		<description>내가 소유한 책 등록</description>
		<query>
            <![CDATA[
             INSERT INTO POSSESSBOOK(book_idNum
             						 , user_idNum
             						 , purchase_date
             						 , purchase_price
             						 , begin_read
             						 , end_read
             						 , quality
             						 , state)   
             VALUES(?, ?, ?, ?, ?, ?, ?, ?)
            ]]>
		</query>
	</sql>



	<sql name="LIST_POSSESSBOOK_SQL">
		<description>내가 소유한 책 목록</description>
		<query>
            <![CDATA[
             SELECT POS.idNum as idNum
                    ,POS.book_idNum as bidNum
                    ,POS.user_idNum as uidNum
                    ,POS.purchase_Date as pdate
                    ,POS.purchase_Price as price
                    ,POS.begin_Read as bread
                    ,POS.end_Read as eread 
                    ,POS.quality as quality
                    ,POS.state  as state
               FROM POSSESSBOOK POS, USER U  
              WHERE U.user_id = ? 
                AND U.isdelete = 0
                AND U.idNum = POS.user_idNum 
              LIMIT ?, ?
            ]]>
		</query>
	</sql>


	<sql name="GET_DBCOUNT_POSSESSBOOK_SQL">
		<description>내가 소유한 책 목록 갯수</description>
		<query>
            <![CDATA[
             SELECT COUNT(POS.idNum) 
               FROM POSSESSBOOK POS, USER U  
              WHERE U.user_id = ? 
                AND U.isdelete = 0
                AND U.idNum = POS.user_idNum 
            ]]>
		</query>
	</sql>


	<sql name="MODIFY_POSSESSBOOK_SQL">
		<description>내가 소유한 책 수정</description>
		<query>
            <![CDATA[
             UPDATE POSSESSBOOK 
                SET purchase_date = ?
                	,purchase_price = ?
                    , begin_read = ?
                    , end_read = ?
                    , quality = ?
                    , state = ?
              WHERE idnum = ? 
            ]]>
		</query>
	</sql>


	<sql name="GET_POSSESSBOOK_SQL">
		<description>내가 소유한 책 조회</description>
		<query>
            <![CDATA[
             SELECT idNum as idNum
                    , book_idNum as bidNum
                    , user_idNum as uidNum
                    , purchase_Date as pdate
                    , purchase_Price as price
                    , begin_Read as bread
                    , end_Read as eread
                    , quality as quality
                    , state as state
               FROM POSSESSBOOK 
              WHERE idNum= ? 
            ]]>
		</query>
	</sql>


	<sql name="IS_OPEN_LIBIDNUM_LIBRARY_SQL">
		<description>서재 공개 여부(서재 일련번호로 조회)</description>
		<query>
            <![CDATA[
             SELECT isopen
               FROM LIBRARY 
              WHERE idNum = ? 
            ]]>
		</query>
	</sql>
	
	<sql name="IS_OPEN_USERID_LIBRARY_SQL">
		<description>서재 공개 여부(서재 주인 아이디로 조회)</description>
		<query>
            <![CDATA[
             SELECT isopen
               FROM LIBRARY L, USER U 
              WHERE U.user_id = ?
                AND L.user_idNum= U.idNum 
            ]]>
		</query>
	</sql>
	
	
	<sql name="DELETE_POSSESSBOOK_SQL">
		<description>내가 소유한 책 삭제</description>
		<query>
            <![CDATA[
             DELETE FROM POSSESSBOOK
              WHERE idNum = ?
            ]]>
		</query>
	</sql>


	<sql name="MODIFY_ISPOSSESS_LIBRARYBOOK_SQL">
		<description>서재 책의 소유 정보 수정</description>
		<query>
            <![CDATA[
             UPDATE LIBRARYBOOK 
    			SET ispossess = NULL
    		  WHERE book_idNum = 
    		  				(SELECT book_idNum 
    		  				   FROM possessbook
    		  				  WHERE idNum = ?) 
    			AND library_idNum = 
    						(SELECT idNum 
    						   FROM library 
    						  WHERE user_idNum= ?)
            ]]>
		</query>
	</sql>


	<sql name="GET_LIST_ZONEBOOK_SQL">
		<description>내 생활반경의 소유책 목록</description>
		<query>
            <![CDATA[
             SELECT POS.idNum as idNum 
			      , POS.state as state
			      , B.idNum as bidNum
			      , B.cover as bcover
			      , B.name as bname
			      , U.idNum as uidNum
			      , U.name as uname
			      , U.user_id as uid
			      , concat(ZC.sido,' ',ZC.gugun,' ',ZC.dong) as zonename
			  FROM POSSESSBOOK POS, USER U, BOOK B,ZIPCODE ZC, (SELECT distinct Z.user_idNum, Z.zone
			 					   FROM ZONE Z 
								  WHERE zone in (
			              				 		 SELECT Z3.zone
			              					   	   FROM ZONE Z3, USER U3,ZIPCODE ZC
			              					   	  WHERE U3.user_id = ? 
			              					   	    AND U3.idNum = Z3.user_idNum
			              					   	)
								) ZU
			 WHERE POS.book_idNum=B.idNum 
			   AND POS.user_idNum=ZU.user_idNum 
			   AND U.idNUm= POS.user_idNum
			   AND ZC.idNum=ZU.zone 
			   AND U.user_id <> ?
			 LIMIT ?, ?
            ]]>
		</query>
	</sql>
	
	
	
	<sql name="GET_DBCOUNT_ZONEBOOK_SQL">
		<description>내 생활반경의 소유책 목록</description>
		<query>
            <![CDATA[
             SELECT COUNT(POS.idNum) 
			   FROM POSSESSBOOK POS, USER U, BOOK B,ZIPCODE ZC, (SELECT distinct Z.user_idNum, Z.zone
			 					   FROM ZONE Z 
								  WHERE zone in (
			              				 		 SELECT Z3.zone
			              					   	   FROM ZONE Z3, USER U3,ZIPCODE ZC
			              					   	  WHERE U3.user_id = ? 
			              					   	    AND U3.idNum = Z3.user_idNum
			              					   	)
								) ZU
			 WHERE POS.book_idNum=B.idNum 
			   AND POS.user_idNum=ZU.user_idNum 
			   AND U.idNUm= POS.user_idNum
			   AND ZC.idNum=ZU.zone 
			   AND U.user_id <> ?
            ]]>
		</query>
	</sql>
	
	
	<sql name="LIST_SEARCH_LIBRARY_SQL">
		<description>서재 검색</description>
		<query>
            <![CDATA[
             SELECT U.idNum as idnum
             		,U.user_id as user_id
             		,U.email as email
             		,U.nickname as nickname
             		,U.name as name
             		,U.isdelete as isdelete
             		,U.input_date as input_date
             		,UAI.idNum as uai_idnum
             		,UAI.blog as blog
             		,UAI.thumnail as thumnail 
               FROM LIBRARY L, USER U, USERADDINFO UAI 
              WHERE L.user_idNum = U.idNum
                AND U.idNum = UAI.user_idNum 
                AND (
                	 U.user_id LIKE ?
		     		 OR U.name LIKE ? 
                     OR U.nickname LIKE ? 
                    )
                AND L.isopen=0
              ORDER BY U.input_date DESC
            ]]>
		</query>
	</sql>
	
	<sql name="LIST_SEARCH_LIBRARYBOOK_SQL">
		<description>서재 검색(읽고싶은책, 읽은책, 읽고 있는 책)</description>
		<query>
            <![CDATA[
				SELECT LB.idNum as idNum
				       ,LB.read_date as read_date
				       ,LB.state as state
				       ,LB.ispossess as ispossess
				       ,B.idnum as bidnum
				       ,LB.library_idnum as lidnum
				       ,L.user_idNum as uidnum
				  FROM LIBRARYBOOK LB ,(
										 SELECT *
										   FROM BOOK 
									          WHERE name LIKE ?
										) B
					   , LIBRARY L  
				 WHERE B.idNum = LB.book_idNum
				   AND LB.library_idNum = ? 
				   AND LB.library_idNum = L.idNum 
				 LIMIT ? , ?
            ]]>
		</query>
	</sql>
	
	
	<sql name="LIST_DBCOUNT_SEARCH_LIBRARYBOOK_SQL">
		<description>서재 검색(읽고싶은책, 읽은책, 읽고 있는 책) 갯수</description>
		<query>
            <![CDATA[
				SELECT COUNT(LB.idNum) 
				  FROM LIBRARYBOOK LB ,(
										 SELECT *
										   FROM BOOK 
									          WHERE name LIKE ?
										) B
					   , LIBRARY L  
				 WHERE B.idNum = LB.book_idNum
				   AND LB.library_idNum = ? 
				   AND LB.library_idNum = L.idNum 
            ]]>
		</query>
	</sql>
	
	
	<sql name="LIST_SEARCH_POSSESSBOOK_SQL">
		<description>서재 검색(소유책)</description>
		<query>
            <![CDATA[
				SELECT POS.idNum as idNum
				       ,POS.purchase_Date as pdate
				       ,POS.purchase_Price as price
				       ,POS.begin_read as bread 
				       ,POS.end_read as eread
				       ,POS.quality as quality
				       ,POS.state as state
				       ,B.idnum bidnum
				       ,L.user_idNum as uidnum
				  FROM POSSESSBOOK POS ,(
										 SELECT *
										   FROM BOOK 
									          WHERE name LIKE ?
										) B
				       ,LIBRARY L 
				 WHERE POS.book_idNum=B.idNum 
				   AND POS.user_idNum = L.user_idNum
				   AND L.idNum = ?
				 LIMIT ?, ?
            ]]>
		</query>
	</sql>
	
	
	<sql name="LIST_DBCOUNT_SEARCH_POSSESSBOOK_SQL">
		<description>서재 검색(소유책) 갯수</description>
		<query>
            <![CDATA[
				SELECT COUNT(POS.idNum) 
				  FROM POSSESSBOOK POS ,(
										 SELECT *
										   FROM BOOK 
									          WHERE name LIKE ?
										) B
				       ,LIBRARY L 
				 WHERE POS.book_idNum=B.idNum 
				   AND POS.user_idNum = L.user_idNum
				   AND L.idNum = ?
            ]]>
		</query>
	</sql>





</sqls>