<?xml version="1.0" encoding="utf-8"?>

<sqls name="bookReview">

	<sql name="INSERT_BOOKREVIEW_SQL">
		<description>책 리뷰 등록</description>
		<query>
            <![CDATA[
             INSERT INTO BOOKREVIEW(book_idNum, user_idNum, recommend, title, review)  
             VALUES (?, ?, ?, ?, ?)
            ]]>
		</query>
	</sql>


	<sql name="INSERT_RECOMMEND_SQL">
		<description>추천인 등록</description>
		<query>
            <![CDATA[
             INSERT INTO RECOMMEND(user_idNum, review_idNum)   
             VALUES (?, ?)
            ]]>
		</query>
	</sql>

	<sql name="MODIFY_BOOKREVIEW_SQL">
		<description>책 리뷰 수정하기</description>
		<query>
            <![CDATA[
             UPDATE BOOKREVIEW 
             	SET TITLE = ? 
             	    ,REVIEW = ?
              WHERE idNum=?
                AND user_idNum=? 
                AND book_idNum=?
            ]]>
		</query>
	</sql>

	<sql name="MODIFY_REVIEWRECOMMEND_SQL">
		<description>책 리뷰 추천수 증가</description>
		<query>
            <![CDATA[
             UPDATE BOOKREVIEW 
             	SET recommend=recommend+1 
              WHERE idNum=? 
                AND book_idNum=?
            ]]>
		</query>
	</sql>

	<sql name="DELETE_BOOKREVIEW_SQL">
		<description>책 리뷰 삭제</description>
		<query>
            <![CDATA[
             DELETE FROM BOOKREVIEW 
             WHERE book_idNum=? 
               AND user_idNum=? 
            ]]>
		</query>
	</sql>


	<sql name="LIST_BOOKREVIEW_SQL">
		<description>책 리뷰 목록(책조회시)</description>
		<query>
            <![CDATA[
             SELECT U.idNum as uidNum
             	    ,U.user_id as user_id 
             	    ,U.name as user_name 
             	    ,U.nickname as user_nickname
             	    ,BR.recommend as recommend
             	    ,BR.title as title 
             	    ,BR.idNum as idNum 
             FROM USER U, BOOKREVIEW BR  
             WHERE BR.book_idNum=? 
               AND BR.user_idNum=U.idNum 
               AND U.isdelete=0
             ORDER BY BR.idNum DESC   
             LIMIT ?,? 
            ]]>
		</query>
	</sql>
	
	<sql name="GET_DBCOUNT_BOOKREVIEW_SQL">
		<description>책 리뷰 목록 갯수(책조회시)</description>
		<query>
            <![CDATA[
             SELECT COUNT(BR.idNum) 
             FROM USER U, BOOKREVIEW BR  
             WHERE BR.book_idNum=? 
               AND BR.user_idNum=U.idNum 
               AND U.isdelete=0  
            ]]>
		</query>
	</sql>


	<sql name="LIST_MYBOOKREVIEW_SQL">
		<description>내가 작성한 책 리뷰 목록</description>
		<query>
            <![CDATA[
             SELECT BR.idNum as idNum
             		,BR.recommend as recommend 
             		,BR.title as title 
             		,BR.book_idNum as bidNum
             		,U.idNum as uidNum 
             FROM USER U, BOOKREVIEW BR  
             WHERE BR.user_idNum = ?  
               AND BR.user_idNum=U.idNum 
               AND U.isdelete=0
             ORDER BY BR.idNum DESC  
             LIMIT ?,? 
            ]]>
		</query>
	</sql>
	
	
	<sql name="GET_DBCOUNT_MYBOOKREVIEW_SQL">
		<description>내가 작성한 책 리뷰 목록 갯수</description>
		<query>
            <![CDATA[
             SELECT COUNT(BR.idNum)  
             FROM USER U, BOOKREVIEW BR  
             WHERE BR.user_idNum = ?  
               AND BR.user_idNum=U.idNum 
               AND U.isdelete=0 
            ]]>
		</query>
	</sql>


	<sql name="GET_MY_BOOKREVIEW_SQL">
		<description>책 리뷰(내가쓴 리뷰)</description>
		<query>
            <![CDATA[
             SELECT U.idNum as uidNum
             	    ,U.user_id as user_id 
             	    ,U.name as user_name 
             	    ,U.nickname as user_nickname
             	    ,BR.idNum as idNum 
             	    ,BR.recommend as recommend
             	    ,BR.review as review 
             	    ,BR.title as title 
             	    ,BR.book_idNum as bidNum 
             FROM USER U, BOOKREVIEW BR  
             WHERE BR.book_idNum = ? 
               AND BR.user_idNum = ?  
               AND BR.user_idNum = U.idNum 
               AND U.isdelete = 0  
            ]]>
		</query>
	</sql>

	<sql name="GET_BOOKREVIEW_SQL">
		<description>책 리뷰</description>
		<query>
            <![CDATA[
             SELECT U.idNum as uidNum
             	    ,U.user_id as user_id 
             	    ,U.name as user_name 
             	    ,U.nickname as user_nickname
             	    ,BR.idNum as idNum 
             	    ,BR.recommend as recommend
             	    ,BR.review as review 
             	    ,BR.title as title
             	    ,B.idNum as bidNum 
             FROM USER U, BOOKREVIEW BR, BOOK B  
             WHERE BR.idNum = ? 
               AND BR.user_idNum = U.idNum 
               AND BR.book_idNum = B.idNum  
               AND U.isdelete = 0    
            ]]>
		</query>
	</sql>


	<sql name="EXIST_MYBOOKREVIEW_SQL">
		<description>내가 작성한 책 리뷰가 있는지 체크</description>
		<query>
            <![CDATA[
             SELECT count(BR.idNum) as count 
             FROM BOOKREVIEW BR, USER U 
             WHERE BR.book_idNum = ? 
               AND BR.user_idNum = ? 
               AND BR.user_idNum = U.idNum 
               AND U.isdelete=0  
            ]]>
		</query>
	</sql>


	<sql name="EXIST_RECOMMEND_SQL">
		<description>내가 추천한 기록이 있는지 체크</description>
		<query>
            <![CDATA[
             SELECT count(*) as count 
             FROM RECOMMEND 
             WHERE review_idNum = ? 
               AND user_idNum = ? 
            ]]>
		</query>
	</sql>
</sqls>